# 1.项目概述
  本项目为应急跌落事件监控系统，应用于铁塔作业人员安全监控领域。项目组成有终端，云端。终端为STM32+MPU6050+气压计+GNSS+4G网络模块。云端通过MQTT接受终端数据，并通过网页方式展现终端上报的数据。
 
# 2.项目功能
## 2.1 终端功能
### 2.1.1 传感器数据采集
- 采集MPU6050的三轴加速度，三轴角速度，三轴角度数据
- 采集气压计的气压数据
- 采集GNSS的经纬度数据
### 2.1.2 传感器数据处理
- 采集的数据通过滑动滤波算法进行滤波处理
- 通过三轴加速度计算出三轴角度
- 通过气压计数值处理单位时间内高度变化

### 2.1.3 传感器数据上报
- 通过4G网络模块将数据上报到云端
- 通过MQTT协议上报数据
### 2.1.4 传感器数据存储
- 终端不保存数据

### 2.1.5 传感器数据显示
- 通过串口打印传感器数据
### 2.1.6 传感器数据报警
- 暂时不设置报警功能，只将数据上传云端

## 2.2 云端功能
### 2.2.1 数据接收
- 通过MQTT协议接收
### 2.2.2 数据处理
- 数据处理暂时不做
### 2.2.3 数据存储
- 将数据存储到数据库中
### 2.2.4 数据显示
- 通过网页显示数据
### 2.2.5 数据报警
- 暂时不做报警

# 2.通信协议设计
## 2.1 STM32和4G模块通信
- 串口连接
- STM32按固定间隔采样数据（比如100ms），然后每隔5秒打包发给4G模块
- 4G模块收到数据后，通过MQTT协议发送到云端
### 2.1.1 协议原则
- 考虑上传效率，效率优先
- 考虑数据包大小，尽量减少数据包大小
- 考虑数据包的可靠性，尽量保证数据包的可靠性
- 考虑数据包的实时性，尽量保证数据包的实时性
- 考虑数据包的安全性，尽量保证数据包的安全性
- 考虑数据包的兼容性，尽量保证数据包的兼容性
- 考虑数据包的可扩展性，尽量保证数据包的可扩展性
- 考虑数据包的可维护性，尽量保证数据包的可维护性
- 考虑数据包的可读性，尽量保证数据包的可读性
- 考虑数据包的可测试性，尽量保证数据包的可试性

# 3. 4G网络模块
## 3.1 技术架构
- 采用移远EC800M-CN模块，使用QPython技术开发
- 下行使用串口连接STM32主控
- 上行使用MQTT服务连接云端

# 4. 云端
## 4.1 云端架构
- 云端单服务器，使用mosquitto搭建MQTT服务器
- 在同一台服务器上（有公网IP），搭建一个网站，后端处理收到的数据，前端页面实时刷新收到的数据
- 前端页面分为几个区域，一个区域展示地图位置（考虑外接免费地图API显示），一个区域属于打印区域，把接收到并解析完的数据滚动显示出来。一个区域用于针对气压值，加速度值，角度值等进行图表化展示。
